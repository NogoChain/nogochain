# NogoChain 生产环境部署教程

## 1. 硬件要求

### 1.1 节点服务器要求
- **CPU**: 至少 4 核处理器，推荐 8 核以上
- **内存**: 至少 16GB RAM，推荐 32GB 以上
- **存储**: 至少 500GB SSD，推荐 1TB NVMe SSD
- **网络**: 至少 100Mbps 带宽，推荐 1Gbps 以上
- **操作系统**: Windows Server 2016+ 或 Linux (Ubuntu 20.04+)

### 1.2 矿池服务器要求
- **CPU**: 至少 8 核处理器，推荐 16 核以上
- **内存**: 至少 32GB RAM，推荐 64GB 以上
- **存储**: 至少 1TB SSD，推荐 2TB NVMe SSD
- **网络**: 至少 1Gbps 带宽，推荐 10Gbps 以上
- **操作系统**: Windows Server 2016+ 或 Linux (Ubuntu 20.04+)

## 2. 网络配置

### 2.1 端口设置
| 服务 | 默认端口 | 用途 | 是否需要公网开放 |
|------|---------|------|----------------|
| 节点 P2P | 30303 | 节点间通信 | 是 |
| 节点 RPC | 8545 | JSON-RPC 接口 | 否（仅本地访问） |
| 节点 WebSocket | 8546 | WebSocket 接口 | 否（仅本地访问） |
| 矿池 P2P | 30304 | 矿池节点间通信 | 是 |
| 矿池 RPC | 8547 | 矿池 JSON-RPC 接口 | 否（仅本地访问） |
| 矿池 Stratum | 3333 | 矿工连接端口 | 是 |

### 2.2 防火墙配置
- 允许 P2P 端口和 Stratum 端口的入站连接
- 限制 RPC 端口仅允许本地访问
- 启用防火墙日志记录

## 3. 部署准备

### 3.1 环境检查
1. 检查 Go 版本（要求 Go 1.22+）
2. 检查系统依赖
3. 验证网络连接

### 3.2 目录结构
```
nogochain/
├── mainnet/
│   ├── config/          # 配置文件
│   ├── data/            # 区块链数据
│   ├── logs/            # 日志文件
│   ├── start_node.bat   # 节点启动脚本
│   └── start_pool.bat   # 矿池启动脚本
├── build/               # 编译产物
├── docs/                # 文档
└── scripts/             # 工具脚本
```

## 4. 节点部署步骤

### 4.1 下载和安装
1. 从官方仓库下载最新版本的 NogoChain
2. 解压到指定目录
3. 验证文件完整性

### 4.2 配置文件生成
1. 运行 `start-mainnet-node.bat` 脚本
2. 脚本会自动生成默认配置文件
3. 根据实际环境修改配置参数

### 4.3 初始化区块链
1. 脚本会自动初始化创世区块
2. 验证初始化结果

### 4.4 启动节点
1. 执行启动脚本
2. 监控日志输出
3. 验证节点同步状态

### 4.5 节点监控
1. 配置 Prometheus 和 Grafana
2. 设置监控指标
3. 配置告警规则

## 5. 矿池部署步骤

### 5.1 下载和安装
1. 从官方仓库下载最新版本的 NogoChain 矿池组件
2. 解压到指定目录
3. 验证文件完整性

### 5.2 配置文件生成
1. 运行 `start-mainnet-pool.bat` 脚本
2. 脚本会自动生成默认配置文件
3. 根据实际环境修改配置参数

### 5.3 连接到节点
1. 配置矿池连接到本地或远程节点
2. 验证连接状态

### 5.4 启动矿池
1. 执行启动脚本
2. 监控日志输出
3. 验证矿池运行状态

### 5.5 矿池管理
1. 配置矿工接入参数
2. 设置挖矿难度调整
3. 配置奖励分配规则

## 6. 安全设置

### 6.1 系统安全
- 更新系统补丁
- 禁用不必要的服务
- 配置强密码策略
- 启用多因素认证

### 6.2 网络安全
- 使用防火墙限制访问
- 配置 VPN 访问内部服务
- 启用 SSL/TLS 加密
- 定期进行安全扫描

### 6.3 区块链安全
- 使用 JWT 认证保护 RPC 接口
- 配置合理的 gas 限制
- 监控异常交易
- 定期备份钱包和配置

## 7. 常见问题和解决方案

### 7.1 节点同步问题
- 检查网络连接
- 增加内存和存储资源
- 调整同步参数

### 7.2 矿池连接问题
- 检查 Stratum 端口配置
- 验证节点连接状态
- 调整矿池参数

### 7.3 性能优化
- 调整数据库缓存大小
- 优化网络参数
- 配置适当的日志级别

### 7.4 安全问题
- 定期更新软件版本
- 监控异常访问
- 执行安全审计

## 8. 维护和升级

### 8.1 日常维护
- 监控系统资源使用
- 检查日志文件
- 备份重要数据

### 8.2 版本升级
- 下载最新版本
- 停止服务
- 替换二进制文件
- 启动服务并验证

### 8.3 数据备份
- 定期备份区块链数据
- 备份配置文件和钱包
- 测试恢复流程

## 9. 故障排查

### 9.1 日志分析
- 查看错误日志
- 分析警告信息
- 识别异常模式

### 9.2 常见错误代码
| 错误代码 | 描述 | 解决方案 |
|---------|------|----------|
| 404 | 资源未找到 | 检查路径和配置 |
| 500 | 内部服务器错误 | 查看详细日志 |
| 503 | 服务不可用 | 检查服务状态 |
| 429 | 请求过多 | 调整请求频率 |

### 9.3 紧急恢复
- 停止服务
- 恢复备份数据
- 启动服务
- 验证恢复结果

## 10. 最佳实践

### 10.1 硬件选择
- 使用 SSD 存储提高性能
- 配置足够的内存
- 选择稳定的网络连接

### 10.2 网络配置
- 使用静态 IP 地址
- 配置适当的 MTU 值
- 启用网络 QoS

### 10.3 监控和告警
- 配置全面的监控
- 设置合理的告警阈值
- 建立响应流程

### 10.4 安全加固
- 定期更新系统和软件
- 实施最小权限原则
- 加密敏感数据

## 11. 联系方式

### 11.1 技术支持
- 官方文档：https://github.com/nogochain/docs
- 社区论坛：https://forum.nogochain.org
- 技术支持：support@nogochain.org

### 11.2 紧急支持
- 紧急联系电话：+86-123-4567-8910
- 紧急支持邮箱：emergency@nogochain.org

## 12. 附录

### 12.1 配置文件示例

#### 节点配置文件 (node_config.json)
```json
{
  "chain_id": 318,
  "data_dir": "mainnet/data",
  "log_dir": "mainnet/logs",
  "p2p_port": 30303,
  "rpc_port": 8545,
  "ws_port": 8546,
  "max_peers": 50,
  "min_gas_price": "1000000000",
  "gas_limit": "8000000",
  "metrics": true,
  "metrics_port": 6060,
  "jwt_secret": "mainnet/jwt-token.txt"
}
```

#### 矿池配置文件 (mining_pool_config.json)
```json
{
  "pool_name": "NogoChain Pool",
  "node_url": "http://localhost:8545",
  "stratum_port": 3333,
  "stratum_tcp_port": 3334,
  "stratum_tls_port": 3335,
  "payment_interval": 600,
  "min_payout": "1000000000000000000",
  "fee": 0.01,
  "reward_address": "0xYourRewardAddress",
  "stats_interval": 30,
  "hashrate_window": 600,
  "max_conns_per_ip": 10
}
```

### 12.2 启动脚本参数

#### 节点启动脚本参数
- `--datadir`: 数据目录路径
- `--config`: 配置文件路径
- `--genesis`: 创世区块文件路径
- `--port`: P2P 端口
- `--rpcport`: RPC 端口
- `--wsport`: WebSocket 端口
- `--metrics`: 启用指标监控
- `--verbosity`: 日志详细程度

#### 矿池启动脚本参数
- `--datadir`: 数据目录路径
- `--config`: 配置文件路径
- `--nodeargs`: 节点参数
- `--poolargs`: 矿池参数
- `--help`: 显示帮助信息

### 12.3 监控指标

#### 节点监控指标
- `nogo_block_height`: 当前区块高度
- `nogo_peers_count`: 连接的对等节点数
- `nogo_gas_used`: 已使用的 gas
- `nogo_transactions_count`: 交易数量
- `nogo_sync_status`: 同步状态

#### 矿池监控指标
- `nogo_pool_hashrate`: 矿池算力
- `nogo_pool_miners`: 连接的矿工数
- `nogo_pool_shares`: 提交的份额数
- `nogo_pool_rewards`: 奖励金额
- `nogo_pool_payments`: 支付次数

### 12.4 故障排查命令

#### 节点故障排查
- `nogocli.exe status`: 查看节点状态
- `nogocli.exe block`: 查看最新区块
- `nogocli.exe peers`: 查看对等节点
- `nogocli.exe txpool`: 查看交易池

#### 矿池故障排查
- `nogocli.exe pool status`: 查看矿池状态
- `nogocli.exe pool miners`: 查看连接的矿工
- `nogocli.exe pool stats`: 查看矿池统计信息
- `nogocli.exe pool payments`: 查看支付记录

## 13. 版本历史

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| v1.0.0 | 2024-01-01 | 初始版本 |
| v1.0.1 | 2024-01-15 | 性能优化 |
| v1.0.2 | 2024-02-01 | 安全更新 |
| v1.1.0 | 2024-03-01 | 功能增强 |

## 14. 免责声明

本教程仅供参考，实际部署应根据具体环境进行调整。部署过程中请确保遵循相关法律法规，注意安全防护措施。NogoChain 团队不对因使用本教程而导致的任何损失负责。

---

**文档版本**: v1.1.0
**最后更新**: 2024-03-01
**作者**: NogoChain 团队